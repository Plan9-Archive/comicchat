<!doctype html>

<head>
	<title>comicchat</title>
	<script src="https://code.jquery.com/jquery-2.0.0b1.js"></script>
</head>

<script>
var cc = {};

$(document).ready(function () {
	$("#send").click(function () {
		var request = $.ajax({
			url: '/send',
			type: 'post',
			data: JSON.stringify({ text: $("#text").val() }),
			success: function (data) { $("#output").append(data); }
		});
	});

	cc.name = localStorage['comicchat_name'];
	if (! cc.name) {
		cc.getName();
	}

	// image urls over websocket
	var loc = window.location, new_uri;
	if (loc.protocol === "https:") {
		new_uri = "wss:";
	} else {
		new_uri = "ws:";
	}
	new_uri += "//" + loc.host;
	new_uri += loc.pathname + "new";

	if (window["WebSocket"]) {
		conn = new WebSocket(new_uri);
		conn.onclose = function(evt) {
		}
		conn.onmessage = function(evt) {
			newurl = JSON.parse(evt.data);
			$('html, body').animate(
				{scrollTop: $(document).height()-$(window).height()}, 
				100
			);

			$("#output").append("<img src='" + newurl.Url + "' />");
		}
	}
});

cc.getName = function () {
	$("#name").show();
	$("#set").show();
	$("#set").click(function () {
		localStorage['comicchat_name'] = $("#name").val();
		$("#name").hide();
		$("#set").hide();
	});
};

</script>
<body>
<!--
<input style="display:none" id="name" /><button style="display:none" id="set">set name</button>
<input style="display: none" width=40 id="text" />
<button style="display: none" id="send">send</button>
-->
<div id="output"></div>
</body>
</html>

